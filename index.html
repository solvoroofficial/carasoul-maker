<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>Carasoul Solvoro ¬∑ friendly carousel maker</title>
    <!-- modern rounded font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Fabric.js for canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(145deg, #0f0f17 0%, #1a1a28 100%);
            color: #f0eef7;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .glass-app {
            width: 1500px;
            max-width: 100%;
            background: rgba(22, 22, 30, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 48px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255, 255, 255, 0.06) inset;
            overflow: hidden;
        }

        .app-grid {
            display: flex;
            flex-direction: row;
        }

        /* left panel ‚Äî fluffy controls */
        .settings-panel {
            width: 380px;
            background: rgba(18, 18, 26, 0.7);
            backdrop-filter: blur(8px);
            padding: 32px 24px;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .welcome-header h2 {
            font-weight: 600;
            font-size: 26px;
            color: #ffffff;
            letter-spacing: -0.2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .welcome-header h2 span {
            background: #7d6cf0;
            padding: 6px 14px;
            border-radius: 60px;
            font-size: 16px;
            font-weight: 500;
            color: white;
        }

        .welcome-header p {
            font-size: 15px;
            color: #b5b2d0;
            margin-top: 8px;
            line-height: 1.5;
        }

        .card {
            background: rgba(12, 12, 20, 0.6);
            border-radius: 32px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            box-shadow: 0 20px 30px -20px black;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #cbc8ff;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .upload-drop {
            background: rgba(38, 35, 58, 0.6);
            border-radius: 28px;
            padding: 24px 16px;
            border: 2px dashed #5a4d9c;
            text-align: center;
            transition: 0.2s;
            cursor: pointer;
        }

        .upload-drop:hover {
            background: #322f4a;
            border-color: #9b8cff;
        }

        .upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .upload-label .icon {
            font-size: 36px;
            filter: drop-shadow(0 6px 8px #00000050);
        }

        .bg-preview {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #1d1b2b;
            border-radius: 40px;
            padding: 10px 16px;
            margin-top: 14px;
            font-size: 14px;
        }

        .chip-button {
            background: none;
            border: none;
            color: #f0d6ff;
            font-size: 18px;
            cursor: pointer;
            padding: 0 8px;
        }

        /* canvas size toggle */
        .size-options {
            display: flex;
            gap: 12px;
            margin: 8px 0;
        }

        .size-btn {
            flex: 1;
            background: #222032;
            border: 1px solid #3e3b58;
            border-radius: 40px;
            padding: 12px 0;
            font-weight: 600;
            color: #cbc8f0;
            cursor: pointer;
            transition: 0.15s;
            font-size: 14px;
        }

        .size-btn.active {
            background: #5f51c0;
            border-color: #9b8aff;
            color: white;
            box-shadow: 0 8px 14px #2d218050;
        }

        /* text input */
        .text-field {
            background: #201f2c;
            border-radius: 60px;
            padding: 4px 4px 4px 24px;
            display: flex;
            align-items: center;
            border: 1px solid #4f4a70;
        }

        .text-field input {
            background: transparent;
            border: none;
            padding: 16px 0;
            font-size: 16px;
            width: 100%;
            color: white;
            outline: none;
            font-family: 'Quicksand', sans-serif;
        }

        .text-field input::placeholder {
            color: #7f7aa3;
        }

        .slider-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #cac5f0;
        }

        input[type=range] {
            width: 100%;
            height: 6px;
            background: #2d2a40;
            border-radius: 20px;
            -webkit-appearance: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #ffffff;
            border-radius: 50%;
            border: 2px solid #8a7cff;
            box-shadow: 0 4px 10px black;
            cursor: pointer;
        }

        .color-row {
            display: flex;
            align-items: center;
            gap: 16px;
            background: #201f2c;
            border-radius: 60px;
            padding: 8px 8px 8px 24px;
        }

        #textColor {
            width: 50px;
            height: 40px;
            border-radius: 30px;
            border: 2px solid #5550a0;
            background: transparent;
        }

        .shadow-check {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #201f2c;
            border-radius: 60px;
            padding: 12px 20px;
        }

        .action-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 12px 0;
        }

        .btn {
            background: #2d2a44;
            border: none;
            padding: 14px 20px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 15px;
            color: #f0eaff;
            cursor: pointer;
            transition: 0.15s;
            flex: 1 0 auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border: 1px solid #524d78;
        }

        .btn-primary {
            background: #6c5ce7;
            border-color: #9b8cff;
            color: white;
            box-shadow: 0 10px 18px #3a2e9e40;
        }

        .btn-primary:hover {
            background: #8171f0;
        }

        .preview-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            background: radial-gradient(circle at 30% 40%, #262337, #0c0b14);
        }

        .canvas-frame {
            background: #161222;
            border-radius: 40px;
            padding: 16px;
            box-shadow: 0 40px 70px -10px black, 0 0 0 1px #514b80 inset;
            max-width: 100%;
            transition: all 0.2s ease;
        }

        #carouselCanvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 28px;
            background: #18152a;
        }

        .helper-note {
            color: #8d87b5;
            font-size: 13px;
            margin-top: 16px;
            text-align: center;
        }

        @media (max-width: 950px) {
            .app-grid {
                flex-direction: column;
            }
            .settings-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #34304a;
            }
        }
    </style>
</head>
<body>
<div class="glass-app">
    <div class="app-grid">
        <!-- LEFT: friendly controls -->
        <div class="settings-panel">
            <div class="welcome-header">
                <h2>‚ú® Carasoul Solvoro <span>beta</span></h2>
                <p>make instagram slides in seconds ¬∑ background stays saved</p>
            </div>

            <!-- Background card -->
            <div class="card">
                <div class="card-title">üì∏ 1. your background</div>
                <div class="upload-drop" id="uploadDrop">
                    <label for="bgUpload" class="upload-label">
                        <span class="icon">üñºÔ∏è</span>
                        <span style="font-weight:600;">click to upload image</span>
                        <span style="font-size:13px; color:#aaa2d5;">PNG or JPG (auto saved)</span>
                    </label>
                    <input type="file" id="bgUpload" accept="image/png, image/jpeg, image/jpg, image/webp" hidden>
                </div>
                <div class="bg-preview" id="bgStatus">
                    <span>üíæ <span id="bgMessage">no background yet</span></span>
                    <button class="chip-button" id="clearBgBtn" title="remove">üóëÔ∏è</button>
                </div>
            </div>

            <!-- Canvas size toggles (friendly aspect control) -->
            <div class="card">
                <div class="card-title">üî≤ 2. canvas shape</div>
                <div class="size-options">
                    <button id="sizeSquareBtn" class="size-btn active">‚¨õ square 1:1</button>
                    <button id="sizeMatchBtn" class="size-btn">üñºÔ∏è match image</button>
                </div>
                <p style="font-size:13px; margin-top:8px; color:#afa7dd;">"match image" adjusts canvas to your photo's proportions (max side 1080px)</p>
            </div>

            <!-- Text & styling -->
            <div class="card">
                <div class="card-title">‚úçÔ∏è 3. your message</div>
                <div class="text-field">
                    <input type="text" id="textInput" placeholder="e.g. 'summer vibes'" value="Carasoul Solvoro">
                </div>

                <div style="margin: 16px 0 8px;">
                    <div class="slider-item">
                        <div class="slider-header"><span>üî§ size</span><span id="fontSizeVal" class="badge">58</span></div>
                        <input type="range" id="fontSizeSlider" min="16" max="140" value="58" step="1">
                    </div>
                    <div class="slider-item">
                        <div class="slider-header"><span>üìè line height</span><span id="lineHeightVal">1.3</span></div>
                        <input type="range" id="lineHeightSlider" min="1.0" max="2.5" value="1.3" step="0.1">
                    </div>
                    <div class="slider-item">
                        <div class="slider-header"><span>üßò padding</span><span id="paddingVal">32</span></div>
                        <input type="range" id="paddingSlider" min="0" max="120" value="32" step="2">
                    </div>
                </div>

                <div style="display: flex; gap: 16px; flex-wrap: wrap; margin: 6px 0;">
                    <select id="fontWeightSelect" style="background:#201f2c; border-radius:60px; padding:12px 20px; border:1px solid #4f4a70; color:white; flex:1;">
                        <option value="normal">Regular weight</option>
                        <option value="bold" selected>Bold weight</option>
                    </select>
                    <div class="color-row" style="flex:1;">
                        <span>üé®</span>
                        <input type="color" id="textColor" value="#ffffff">
                    </div>
                </div>

                <div class="shadow-check">
                    <input type="checkbox" id="shadowToggle" checked>
                    <label for="shadowToggle">üåí soft shadow (makes text pop)</label>
                </div>
            </div>

            <!-- action buttons -->
            <div class="card">
                <div class="card-title">üì• 4. export &amp; play</div>
                <div class="action-row">
                    <button class="btn btn-primary" id="downloadPngBtn">üì∏ PNG</button>
                    <button class="btn btn-primary" id="downloadJpgBtn">üåÖ JPG</button>
                </div>
                <div class="action-row">
                    <button class="btn" id="duplicateSlideBtn">‚ûï duplicate text</button>
                    <button class="btn" id="resetTextBtn">‚Ü∫ reset style</button>
                </div>
                <div class="helper-note">
                    ‚¨áÔ∏è downloads at exact canvas size (ready for Instagram)
                </div>
            </div>
        </div>

        <!-- RIGHT: preview canvas -->
        <div class="preview-area">
            <div class="canvas-frame" id="canvasFrame">
                <canvas id="carouselCanvas" width="1080" height="1080"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    (function() {
        // friendly canvas app
        const canvasEl = document.getElementById('carouselCanvas');
        let canvas = new fabric.Canvas(canvasEl, {
            enableRetinaScaling: true,
            backgroundColor: '#18152a',
            preserveObjectStacking: false,
            width: 1080,
            height: 1080
        });

        let textbox = null;
        const STORAGE_KEY = 'carasoul_solvoro_bg';

        // current image dimensions (for match mode)
        let currentImageWidth = 1080, currentImageHeight = 1080; // fallback
        let matchMode = false; // square by default

        // ---- helper: resize canvas (preserve background & text centering) ----
        function resizeCanvas(newWidth, newHeight) {
            if (newWidth < 10 || newHeight < 10) return;

            // store old background and text
            const oldBg = canvas.backgroundImage;
            const oldText = textbox;

            canvas.setWidth(newWidth).setHeight(newHeight);

            if (oldBg) {
                // re-set background with cover scale (or contain? we keep cover style)
                const img = oldBg;
                const scale = Math.max(newWidth / img.width, newHeight / img.height);
                img.set({
                    scaleX: scale,
                    scaleY: scale,
                    left: (newWidth - img.width * scale) / 2,
                    top: (newHeight - img.height * scale) / 2,
                });
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
            }

            // re-center textbox
            if (oldText) {
                oldText.set({
                    left: newWidth / 2,
                    top: newHeight / 2,
                });
                // adjust textbox width for wrapping (keep some margin)
                oldText.set({ width: newWidth * 0.8 }); // 80% of canvas
                canvas.renderAll();
            } else {
                // create default textbox after resize if missing
                initTextbox();
            }
            canvas.renderAll();
        }

        // ---- set background cover with given image element ----
        function setBackgroundCover(imgElement, imgWidth, imgHeight) {
            const scale = Math.max(canvas.width / imgWidth, canvas.height / imgHeight);
            imgElement.set({
                scaleX: scale,
                scaleY: scale,
                left: (canvas.width - imgWidth * scale) / 2,
                top: (canvas.height - imgHeight * scale) / 2,
                originX: 'left',
                originY: 'top'
            });
            canvas.setBackgroundImage(imgElement, canvas.renderAll.bind(canvas));
        }

        // ---- load background from storage and optionally match mode ----
        function loadBackgroundFromStorage() {
            const savedDataURL = localStorage.getItem(STORAGE_KEY);
            if (savedDataURL) {
                fabric.Image.fromURL(savedDataURL, (img) => {
                    currentImageWidth = img.width;
                    currentImageHeight = img.height;
                    if (matchMode) {
                        // match canvas to image dimensions (cap longest side at 1080 to keep ui friendly)
                        let targetW = img.width, targetH = img.height;
                        const maxDim = 1080;
                        if (targetW > maxDim || targetH > maxDim) {
                            const ratio = Math.min(maxDim / targetW, maxDim / targetH);
                            targetW = Math.floor(targetW * ratio);
                            targetH = Math.floor(targetH * ratio);
                        }
                        resizeCanvas(targetW, targetH);
                    }
                    // after possible resize, set background cover
                    // but we need to get the img again? fabric image already has original size.
                    // re-fetch or use current img? better set directly with proper scale
                    const scale = Math.max(canvas.width / img.width, canvas.height / img.height);
                    img.set({
                        scaleX: scale,
                        scaleY: scale,
                        left: (canvas.width - img.width * scale) / 2,
                        top: (canvas.height - img.height * scale) / 2,
                    });
                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
                    document.getElementById('bgMessage').innerText = 'background ready';
                }, { crossOrigin: 'anonymous' });
            } else {
                document.getElementById('bgMessage').innerText = 'no background saved';
            }
        }

        // ---- save background dataURL ----
        function saveBackgroundToStorage(dataURL) {
            try {
                localStorage.setItem(STORAGE_KEY, dataURL);
                document.getElementById('bgMessage').innerText = 'saved in browser';
            } catch (e) {
                alert('Image too large for storage, try smaller.');
            }
        }

        // ---- upload handler ----
        document.getElementById('bgUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const dataURL = event.target.result;
                fabric.Image.fromURL(dataURL, (img) => {
                    currentImageWidth = img.width;
                    currentImageHeight = img.height;

                    if (matchMode) {
                        let targetW = img.width, targetH = img.height;
                        const maxDim = 1080;
                        if (targetW > maxDim || targetH > maxDim) {
                            const ratio = Math.min(maxDim / targetW, maxDim / targetH);
                            targetW = Math.floor(targetW * ratio);
                            targetH = Math.floor(targetH * ratio);
                        }
                        resizeCanvas(targetW, targetH);
                    } else {
                        // ensure canvas is square 1080
                        if (canvas.width !== 1080 || canvas.height !== 1080) {
                            resizeCanvas(1080, 1080);
                        }
                    }

                    // now set background with cover on current canvas size
                    const scale = Math.max(canvas.width / img.width, canvas.height / img.height);
                    img.set({
                        scaleX: scale,
                        scaleY: scale,
                        left: (canvas.width - img.width * scale) / 2,
                        top: (canvas.height - img.height * scale) / 2,
                    });
                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
                    saveBackgroundToStorage(dataURL);
                }, { crossOrigin: 'anonymous' });
            };
            reader.readAsDataURL(file);
            this.value = '';
        });

        // clear background
        document.getElementById('clearBgBtn').addEventListener('click', function() {
            canvas.setBackgroundImage(null, canvas.renderAll.bind(canvas));
            localStorage.removeItem(STORAGE_KEY);
            document.getElementById('bgMessage').innerText = 'no background';
        });

        // ---- textbox init / update ----
        function initTextbox() {
            if (textbox) canvas.remove(textbox);
            const text = document.getElementById('textInput').value || 'Carasoul Solvoro';
            const fontSize = parseInt(document.getElementById('fontSizeSlider').value, 10);
            const fontWeight = document.getElementById('fontWeightSelect').value;
            const color = document.getElementById('textColor').value;
            const lineHeight = parseFloat(document.getElementById('lineHeightSlider').value);
            const padding = parseInt(document.getElementById('paddingSlider').value, 10);
            const shadowEnabled = document.getElementById('shadowToggle').checked;

            textbox = new fabric.Textbox(text, {
                left: canvas.width / 2,
                top: canvas.height / 2,
                originX: 'center',
                originY: 'center',
                fontSize: fontSize,
                fontWeight: fontWeight,
                fill: color,
                lineHeight: lineHeight,
                padding: padding,
                textAlign: 'center',
                fontFamily: 'Quicksand, sans-serif',
                width: canvas.width * 0.8,  // responsive width
                shadow: shadowEnabled ? 'rgba(0,0,0,0.5) 0px 8px 18px' : '',
                splitByGrapheme: true,
                hasControls: false,
                hasBorders: false,
                lockScalingX: true,
                lockScalingY: true,
                selectable: false,
                evented: false
            });
            canvas.add(textbox);
            canvas.renderAll();
        }

        function updateTextProperties() {
            if (!textbox) { initTextbox(); return; }
            textbox.set({
                text: document.getElementById('textInput').value || ' ',
                fontSize: parseInt(document.getElementById('fontSizeSlider').value, 10),
                fontWeight: document.getElementById('fontWeightSelect').value,
                fill: document.getElementById('textColor').value,
                lineHeight: parseFloat(document.getElementById('lineHeightSlider').value),
                padding: parseInt(document.getElementById('paddingSlider').value, 10),
                shadow: document.getElementById('shadowToggle').checked ? 'rgba(0,0,0,0.5) 0px 8px 18px' : ''
            });
            canvas.renderAll();

            // update small badges
            document.getElementById('fontSizeVal').innerText = document.getElementById('fontSizeSlider').value;
            document.getElementById('lineHeightVal').innerText = parseFloat(document.getElementById('lineHeightSlider').value).toFixed(1);
            document.getElementById('paddingVal').innerText = document.getElementById('paddingSlider').value;
        }

        // ---- toggle square / match mode ----
        document.getElementById('sizeSquareBtn').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('sizeMatchBtn').classList.remove('active');
            matchMode = false;
            if (canvas.width !== 1080 || canvas.height !== 1080) {
                resizeCanvas(1080, 1080);
            }
        });

        document.getElementById('sizeMatchBtn').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('sizeSquareBtn').classList.remove('active');
            matchMode = true;
            // if we have a background image, resize to its dimensions
            if (canvas.backgroundImage) {
                const img = canvas.backgroundImage;
                let targetW = img.width, targetH = img.height;
                const maxDim = 1080;
                if (targetW > maxDim || targetH > maxDim) {
                    const ratio = Math.min(maxDim / targetW, maxDim / targetH);
                    targetW = Math.floor(targetW * ratio);
                    targetH = Math.floor(targetH * ratio);
                }
                resizeCanvas(targetW, targetH);
            } else {
                // no background, maybe keep previous but suggest upload
                // do nothing
            }
        });

        // ---- download ----
        function download(format) {
            const dataURL = canvas.toDataURL({ format: format, quality: 1 });
            const link = document.createElement('a');
            link.download = `carasoul.${format}`;
            link.href = dataURL;
            link.click();
        }

        document.getElementById('downloadPngBtn').addEventListener('click', () => download('png'));
        document.getElementById('downloadJpgBtn').addEventListener('click', () => download('jpeg'));

        // ---- duplicate text ----
        document.getElementById('duplicateSlideBtn').addEventListener('click', function() {
            const current = document.getElementById('textInput').value;
            document.getElementById('textInput').value = current + ' ‚ú¶';
            updateTextProperties();
        });

        // ---- reset style ----
        document.getElementById('resetTextBtn').addEventListener('click', function() {
            document.getElementById('textInput').value = 'Carasoul Solvoro';
            document.getElementById('fontSizeSlider').value = 58;
            document.getElementById('fontWeightSelect').value = 'bold';
            document.getElementById('textColor').value = '#ffffff';
            document.getElementById('lineHeightSlider').value = 1.3;
            document.getElementById('paddingSlider').value = 32;
            document.getElementById('shadowToggle').checked = true;
            updateTextProperties();
        });

        // ---- event listeners ----
        document.getElementById('textInput').addEventListener('input', updateTextProperties);
        document.getElementById('fontSizeSlider').addEventListener('input', updateTextProperties);
        document.getElementById('fontWeightSelect').addEventListener('change', updateTextProperties);
        document.getElementById('textColor').addEventListener('input', updateTextProperties);
        document.getElementById('lineHeightSlider').addEventListener('input', updateTextProperties);
        document.getElementById('paddingSlider').addEventListener('input', updateTextProperties);
        document.getElementById('shadowToggle').addEventListener('change', updateTextProperties);

        // init
        loadBackgroundFromStorage();
        initTextbox();

        // set initial badges
        document.getElementById('fontSizeVal').innerText = document.getElementById('fontSizeSlider').value;
        document.getElementById('lineHeightVal').innerText = document.getElementById('lineHeightSlider').value;
        document.getElementById('paddingVal').innerText = document.getElementById('paddingSlider').value;

        // if no background in storage
        if (!localStorage.getItem(STORAGE_KEY)) {
            document.getElementById('bgMessage').innerText = 'upload a background';
        }

        // extra: drag & drop friendly (optional)
        const dropArea = document.getElementById('uploadDrop');
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        dropArea.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const file = dt.files[0];
            if (file && file.type.match(/image.*/)) {
                document.getElementById('bgUpload').files = dt.files;
                // trigger change manually
                const event = new Event('change', { bubbles: true });
                document.getElementById('bgUpload').dispatchEvent(event);
            }
        });
    })();
</script>
</body>
</html>
